<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style type="text/css">
    * {
        margin: 0;
        padding: 0;
    }

    body {
        background-color: #fefefe;
        /*position: relative;*/
    }

    #sort-view {
        width: 800px;
        height: 400px;
        background-color: #fefeff;
        box-shadow: 0 0 10px 1px rgba(0, 0, 0, 0.1);
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: auto;
    }

    #sort-view ul {
        width: 100%;
        height: 100%;
        list-style: none;
    }

    #sort-view ul:before,
    #sort-view ul:after {
        content: "";
        display: inline-block;
        height: 100%;
        width: 0;
    }

    #sort-view li {
        width: 1%;
        display: inline-block;
        background: #666;
        border-radius: 6px 6px 0px 0px;
    }

    .sorting {
        background-color: #ff0!important;
    }

    .btns {
        margin: 10px;
        text-align: center;
    }

    button {
        width: 80px;
        height: 35px;
        border: 0;
        background-color: #f9f9f9;
        border-bottom: 2px solid #f0f0f0;
        border-top: 2px solid #fff;
        outline: 0px;
        border-radius: 8px;
        color: #666;
        transition: 0.2s linear;
    }

    button:hover {
        background-color: #f5f5f5;
    }
    </style>
</head>

<body>
    <div class="btns">
        <button id="bubble">bubble</button>
        <button id="cocktail">cocktail</button>
        <button id="quick">quick</button>
        <button id="insert">insert</button>
        <button id="shell">shell</button>
    </div>
    <div id="sort-view">
    </div>
    <script>
    function random(start, end) {
        start = (start !== undefined) ? parseFloat(start) : 5;
        end = (end !== undefined) ? parseFloat(end) : 100;
        var num = Math.floor(Math.random() * (end - start + 1) + start);
        return num;
    }

    var len;
    var arr;
    var amount = 100;
    var isSort = false;
    var sortView = document.getElementById('sort-view');
    var container = document.createElement('ul');
    sortView.appendChild(container);

    function createChild() {
        arr = [];
        container.innerHTML = '';
        for (var i = 0; i < amount; i++) {
            var child = document.createElement('li');

            var number = random() * 4;
            Object.defineProperty(child, 'number', {
                // writable: true,
                configurable: true,
                enumerable: true,
                set: function(value) {
                    this.style.height = value + 'px';
                },
                get: function() {
                    return parseInt(this.style.height);
                }
            });
            child.style.height = number + 'px';
            container.appendChild(child);
            arr.push(child);
        }
        addColor();
        len = arr.length;
    }

    function addColor() {
        var tarr = [];
        for (var i = 0; i < arr.length; i++) {
            tarr.push(arr[i]);
        }
        tarr.sort(function(x, y) {
            if (x.number < y.number) {
                return -1;
            } else if (x.number > y.number) {
                return 1;
            } else {
                return 0;
            }
        });
        var startColor = 150;
        for (var i = 0; i < arr.length; i++) {
            var color = `rgba(0, 250, ${startColor++}, 1)`;
            tarr[i].style.backgroundColor = color;
        }
    }

    function refresh() {
        container.innerHTML = '';
        for (var i = 0; i < arr.length; i++) {
            container.appendChild(arr[i]);
        }
    }

    function addHeightLight() {
        for (var i = 0; i < arr.length; i++) {
            arr[i].classList.remove('sorting');
        }
        for (var i = 0; i < arguments.length; i++) {
            arr[arguments[i]].classList.add('sorting');
        }
        refresh();
    }

    function swap(x, y) {
        var temp = arr[x];
        arr[x] = arr[y];
        arr[y] = temp;
        refresh();
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function bubbleSort() {
        for (var i = 0; i < arr.length - 1; i++) {
            for (var j = 0; j < len - i - 1; j++) {
                addHeightLight(j, j + 1);
                await sleep(5);

                if (arr[j].number > arr[j + 1].number) {
                    swap(j, j + 1);
                }
            }
        }
    }

    async function cocktailSort() {
        var i = 0;
        var left = 0;
        var right = arr.length - 1;
        while(left < right) {
            for (var i = left; i < right; i++){
                if (arr[i].number > arr[i + 1].number) {
                    swap(i, i + 1);
                }     

                addHeightLight(i, i + 1);
                await sleep(5);   
       
            }
            right--;
            for (var i = right; i > left; i--){
                if (arr[i - 1].number >arr[i].number) {
                    swap(i, i - 1);
                }
                
                addHeightLight(i, i + 1);
                await sleep(5);
            }
            left++;
        }
    }

    async function quickSort(start, end) {
        var p = start;
        for (var i = start + 1; i <= end; i++) {
            if (arr[i].number < arr[p].number) {
                var temp = arr[i];
                arr.splice(i, 1);
                arr.splice(start, 0, temp);
                p++;
            }

            addHeightLight(p, i);
            await sleep(5);
        }

        if (start < p - 1) {
            quickSort(start, p - 1);
        }
        if (p < end - 1) {
            quickSort(p + 1, end);
        }
    }

    async function insertSort() {
        for (var i = 1; i < arr.length; i++) {
            var j = i - 1;
            var k = i;
            while (j >= 0 && arr[k].number < arr[j].number) {
                addHeightLight(j, k);
                await sleep(1);

                var temp = arr[k];
                arr.splice(k, 1);
                arr.splice(j, 0, temp);
                k = j;
                j--;
            }
        }
        addHeightLight(j, k);
    }

    async function insertSort() {
        for (var i = 1; i < arr.length; i++) {
            var j = i - 1;
            var k = i;
            while (j >= 0 && arr[k].number < arr[j].number) {
                addHeightLight(j, k);
                await sleep(5);

                var temp = arr[k];
                arr.splice(k, 1);
                arr.splice(j, 0, temp);
                k = j;
                j--;
            }
        }
        addHeightLight(j, k);
    }


    async function shellSort() {
        var gap = Math.floor(arr.length / 2);
        while (gap > 0) {
            for (var i = gap; i < arr.length; i += gap) {
                var k = i;
                for (var j = i - gap; j >= 0; j -= gap) {
                    addHeightLight(j, k);
                    await sleep(5);

                    if (arr[j].number > arr[k].number) {
                        var temp = arr[k];
                        arr[k] = arr[j];
                        arr[j] = temp;
                        k = j;
                    } else {
                        break;
                    }
                }
            }
            gap--;
        }
    }

    function init() {
        createChild();
        var btns = document.querySelector('.btns');
        document.querySelector('#bubble').onclick = function() {
            if (isSort) {
                createChild();
            }
            bubbleSort();
            isSort = true;
        };

        document.querySelector('#cocktail').onclick = function() {
            if (isSort) {
                createChild();
            }
            cocktailSort();
            isSort = true;
        };

        document.querySelector('#quick').onclick = function() {
            if (isSort) {
                createChild();
            }
            quickSort(0, arr.length - 1);
            isSort = true;
        };

        document.querySelector('#insert').onclick = function() {
            if (isSort) {
                createChild();
            }
            insertSort();
            isSort = true;
        };
        document.querySelector('#shell').onclick = function() {
            if (isSort) {
                createChild();
            }
            
            shellSort();
            isSort = true;
        };
    }
    init();
    </script>
</body>

</html>